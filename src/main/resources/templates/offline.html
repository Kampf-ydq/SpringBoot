<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>离线分析</title>
    <script src="../js/jquery-3.5.1.min.js"></script>
    <script src="../js/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="../js/bootstrap-3.3.7-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/config.css">
    <script src="../js/switch.js"></script>
    <link href="https://cdn.bootcss.com/bootstrap-switch/3.3.4/css/bootstrap3/bootstrap-switch.min.css" rel="stylesheet"><script src="https://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap-switch/3.3.4/js/bootstrap-switch.min.js"></script>
</head>
<body>
<div id="container4">
    <!--    <div id="container1">-->

    <div class="headrow">请选择待解析的文件：</div>

    <!--        <label id="lable-upload">请选择上传的文件：</label>-->

    <!--AJAX文件上传上传测试-->
    <!--<input id="upload-file" name="file" class="file-loading" type="file" multiple="multiple">-->

    <input id="upload-file-id" type="file" name="file" class="file-loading">
    <button id="load-file" type="button" class="btn btn-info">点击上传</button>

    <!--<input type ="file" id="ImportPicInput" name= "file" style=" display: none" />
    <div class ="input-append">
        <label for ="importPicName"> 上传原始图片：</label >
        <input type ="text" class="input-large" id= "importPicName" />
        <a class ="btn btn-default" onclick= "$('#ImportPicInput').click();" > 打开</a>
    </div >-->

    <!--<form method="post" enctype="multipart/form-data">
        <div class="rowform">
            <input id="upload-file" name="file" class="file-loading" type="file">
        </div>

        <div class="rowform">
            <div class="halfrow">

            </div>
            <div class="halfrow">
                &lt;!&ndash;<span class="input-group-addon" id="basic-addon3">秒</span>&ndash;&gt;
                <button id="load-file" type="button" class="btn btn-info">点击上传</button>
            </div>
        </div>
    </form>-->
    <!--/////////////////////////////////////////////////////////////////////////////////////////////////////////////-->
    <div class="headrow">监听器配置</div>
    <form method="post">

        <div class="rowform">
            <div class="halfrow">
                <label class="sublabel">传输形式：</label>
                <select class="form-control" id="transmittingGrain">
                    <option>0 原始数据包</option>
                    <option>1 包</option>
                    <option>2 流</option>
                    <option>3 会话</option>
                </select>
            </div>
            <div class="halfrow">
                <label class="sublabel">传输超时：</label>
                <div class="input-group2">
                    <input name="transmittingTimeout" type="text" class="form-control shortform" placeholder="10" aria-describedby="basic-addon2">
                    <span class="input-group-addon">秒</span>
                </div>
            </div>
        </div>
        <div class="rowform">
            <div class="halfrow">
                <label class="sublabel">输出形式：</label>
                <select class="form-control" id="outputtingGrain">
                    <option>0 原始数据包</option>
                    <option>1 包</option>
                    <option>2 流</option>
                    <option>3 会话</option>
                </select>
            </div>
            <div class="halfrow">
                <label class="sublabel">输出超时：</label>
                <div class="input-group2">
                    <input name="outputtingTimeout" type="text" class="form-control shortform" placeholder="10" aria-describedby="basic-addon2">
                    <span class="input-group-addon">秒</span>
                </div>
            </div>
        </div>
        <div class="rowform">
            <div class="halfrow">
                <label class="sublabel">插件形式：</label>
                <select class="form-control" id="pluginGrain">
                    <option>0 原始数据包</option>
                    <option selected>1 包</option>
                    <option>2 流</option>
                    <option>3 会话</option>
                </select>
            </div>
            <div class="halfrow">
                <label class="sublabel">插件超时：</label>
                <div class="input-group2">
                    <input name="pluginTimeout" type="text" class="form-control shortform" placeholder="1" aria-describedby="basic-addon2">
                    <span class="input-group-addon">秒</span>
                </div>
            </div>
        </div>
        <div class="rowform">
            <label class="sublabel">meeting超时：</label>

            <input name="meetingTimeout" type="text" class="form-control longform" placeholder="100000000000000000" aria-describedby="basic-addon2">
            <span class="input-group-addon">秒</span>
        </div>
        <div class="rowform">
            <label class="sublabel">最大分段：</label>

            <input name="segmentMax" type="text" class="form-control" placeholder="10000" aria-describedby="basic-addon2">
            <!--            <span class="input-group-addon">个</span>-->
        </div>

        <div class="rowform">
            <label class="sublabel">传输监听器：</label>
        </div>
        <div class="rowform">
            <label class="sublabel2">端口：</label>
            <input name="port" type="text" class="form-control" placeholder="5150" aria-describedby="basic-addon2">
            <!--            <span class="input-group-addon">秒</span>-->
        </div>
        <div class="rowform">
            <label class="sublabel2">网址：</label>
            <input name="netAddress" type="text" class="form-control longform" placeholder="183.198.217.144 #202.199.13.252" aria-describedby="basic-addon2">
            <!--            <span class="input-group-addon">秒</span>-->
        </div>
        <div class="rowform">
            <label class="sublabel">输出配置：</label>
        </div>
        <div class="rowform">
            <label class="sublabel2">文件路径：</label>
            <input name="filePath" type="text" class="form-control longform" placeholder="C:\\Users\\18809\\Desktop\\Honeyeye" aria-describedby="basic-addon2">
            <!--            <span class="input-group-addon">秒</span>-->
        </div>
        <div class="rowform">
            <div class="halfrow">
                <!--                <label class="sublabel">过滤器：</label>-->
                <div class="input-group2">
                    <label class="sublabel2">文件名称：</label>
                    <input name="fileName" type="text" class="form-control longform" placeholder="testPcap" aria-describedby="basic-addon2">
                    <!--                    <input name="filter" type="text" class="form-control longform" placeholder="" aria-describedby="basic-addon2">-->
                </div>
            </div>
        </div>
    </form>
    <!--/////////////////////////////////////////////////////////////////////////////////////////////////////////////-->
    <div class="headrow">输出模式配置</div>
    <form method="post">

        <div class="rowform">
            <div class="halfrow">
                <label class="sublabel">输出模式：</label>
                <select class="form-control" id="output-mode">
                    <option>1 传输</option>
                    <option>2 存储</option>
                    <option>3 传输并存储</option>
                    <option>4 其它</option>
                </select>
            </div>
        </div>
        <div class="halfrow">
            <!--<span class="input-group-addon" id="basic-addon3">秒</span>-->
            <button id="offline-alnaysis" type="button" class="btn btn-info">开始</button>
        </div>
    </form>

</div>
</body>
<script type="text/javascript" src="../js/jquery-3.5.1.min.js"></script>
<script type="text/javascript" src="js/ajaxfileupload.js"></script>
<script type="text/javascript">

    /*$(document).ready(function(e) {
        $('body').on('change',$('#ImportPicInput'),function(){
            $( "#importPicName").val($( "#ImportPicInput").val());
        });
    });*/

    //加载文件
    /*var formData = new FormData();
    formData.append("file", document.getElementById("upload-file").files[0]);
    console.log($("#upload-file")[0].val());*/
    $("#load-file").click(function () {
        /*$.ajax({
            type: "post",
            url: "http://localhost:8080/fileUpload",
            data: formData,
            contentType:false,
            processData:false,//这个很有必要，不然不行
            dataType:"json",
            mimeType:"multipart/form-data",
            success:function(res){
                if(200==res.code){
                    alert("保存成功!" + res.data);
                    return;
                }else{
                    alert("保存失败!" + res.data);
                    return;
                }
            }
        });*/
        $.ajaxFileUpload({
            type: "POST",
            url: "http://localhost:8080/fileUpload",
            secureuri : false,//是否启用安全提交，默认为false
            fileElementId:'upload-file-id',//文件选择框的id属性
            dataType: 'json',//服务器返回的格式
            async : false,
            success: function(res){
                switch (res.code) {
                    case 200:
                        alert("加载文件成功!");
                        break;
                    case 500:
                        alert(res.msg);
                        break;
                    default:
                        alert("加载文件失败!");
                        break;
                }
            }
        });
    });

    $('#offline-alnaysis').click(function () {
        //获取前端参数
        var transmittingGrain = $("#transmittingGrain option:selected").text().split(" ")[0];
        var transmittingTimeout = isEmpty($('input[name="transmittingTimeout"]').val()) ? $('input[name="transmittingTimeout"]').attr("placeholder") : $('input[name="transmittingTimeout"]').val();
        var outputtingGrain = $("#outputtingGrain option:selected").text().split(" ")[0];
        var outputtingTimeout = isEmpty($('input[name="outputtingTimeout"]').val()) ? $('input[name="outputtingTimeout"]').attr("placeholder") : $('input[name="outputtingTimeout"]').val();
        var pluginGrain = $("#pluginGrain option:selected").text().split(" ")[0];
        var pluginTimeout = isEmpty($('input[name="pluginTimeout"]').val()) ? $('input[name="pluginTimeout"]').attr("placeholder") : $('input[name="pluginTimeout"]').val();
        var meetingTimeout = isEmpty($('input[name="meetingTimeout"]').val()) ? $('input[name="meetingTimeout"]').attr("placeholder") : $('input[name="meetingTimeout"]').val();
        var segmentMax = isEmpty($('input[name="segmentMax"]').val()) ? $('input[name="segmentMax"]').attr("placeholder") : $('input[name="segmentMax"]').val();
        var portNum = isEmpty($('input[name="port"]').val()) ? $('input[name="port"]').attr("placeholder") : $('input[name="port"]').val();
        var netAddress = isEmpty($('input[name="netAddress"]').val()) ? $('input[name="netAddress"]').attr("placeholder") : $('input[name="netAddress"]').val();
        var filePath = isEmpty($('input[name="filePath"]').val()) ? $('input[name="filePath"]').attr("placeholder") : $('input[name="filePath"]').val();
        var fileName = isEmpty($('input[name="fileName"]').val()) ? $('input[name="fileName"]').attr("placeholder") : $('input[name="fileName"]').val();

        //输出配置部分的前台参数
        var outputMode = $("#output-mode option:selected").text().split(" ")[0];

        //测试
        console.log(transmittingGrain+","+transmittingTimeout+","+outputtingGrain+","+outputtingTimeout+","+pluginGrain+","+pluginTimeout);
        console.log(meetingTimeout+","+segmentMax+","+portNum+","+netAddress+","+filePath+","+fileName);

        //封装JSON数据
        var configParam = {
            "system": {
                /*"inputingMode":2 # 1:capture, 2:load*/
                "outputingMode":outputMode
            },
            "listener": {
                "transmittingGrain":transmittingGrain,
                "transmittingTimeout":transmittingTimeout,
                "outputtingGrain":outputtingGrain,
                "outputtingTimeout":outputtingTimeout,
                "pluginGrain":pluginGrain,
                "pluginTimeout":pluginTimeout,
                "meetingTimeout":meetingTimeout,
                "segmentMax":segmentMax,
                "transmittingListener":{
                    "port":portNum,
                    "netAddress":netAddress
                }
            },
            "outputer": {
                "filePath":filePath,
                "fileName":fileName
            }
        }

        $.ajax({
            type: "post",
            url: "http://localhost:8080/offline",
            data: JSON.stringify(configParam),
            contentType: "application/json",
            dataType: "json",
            success: function(res) {
                // data = jQuery.parseJSON(data);  //dataType指明了返回数据为json类型，故不需要再反序列化
            }
        });

    });

    //判断是否为空
    function isEmpty(v) {
        if (v === null || v === undefined || v === "")
        {
            return true;
        }else{
            return false;
        }
    }


</script>
</html>